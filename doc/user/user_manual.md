# 智能Agent任务管理系统 - 用户手册

## 目录

1. [系统概述](#系统概述)
2. [安装与配置](#安装与配置)
3. [快速入门](#快速入门)
4. [命令行界面](#命令行界面)
5. [任务管理](#任务管理)
6. [知识库管理](#知识库管理)
7. [工具管理](#工具管理)
8. [信息补充循环](#信息补充循环)
9. [结果验证](#结果验证)
10. [常见问题](#常见问题)

## 系统概述

智能Agent任务管理系统是一个基于大语言模型(LLM)的智能任务处理系统，具有任务分解、信息收集、结果验证等功能。系统通过命令行界面与用户交互，提供友好的操作体验。

### 主要功能

- **任务管理**：创建、执行、查看任务和子任务
- **任务分解**：将复杂任务自动分解为可执行的子任务
- **知识库管理**：管理知识库，支持文档添加、检索和删除
- **工具管理**：管理各种工具，如文件操作、代码生成、UML生成等
- **信息补充循环**：在任务执行过程中动态收集额外信息
- **结果验证**：验证任务结果的质量，生成验证报告
- **用户确认**：在关键步骤获取用户确认，确保结果符合期望

### 系统架构

系统采用模块化设计，主要包含以下模块：
- 数据库管理模块：负责数据的存储和检索
- RAG知识管理模块：负责知识库的管理和检索
- MCP工具管理模块：负责工具的注册和管理
- Agent流程管理模块：负责任务的整体执行流程
- 命令行交互模块：负责与用户的交互
- 信息补充循环：负责在任务执行过程中收集额外信息
- LLM验证模块：负责验证任务结果的质量

## 安装与配置

### 系统要求

- Python 3.8 或更高版本
- SQLite 3
- 足够的磁盘空间用于存储数据库和知识库

### 安装步骤

1. **克隆仓库**：
   ```bash
   git clone https://github.com/your-organization/agent-task-management-system.git
   cd agent-task-management-system
   ```

2. **创建虚拟环境**：
   ```bash
   python -m venv venv
   source venv/bin/activate  # Linux/Mac
   # 或
   venv\Scripts\activate  # Windows
   ```

3. **安装依赖**：
   ```bash
   pip install -r requirements.txt
   ```

4. **配置环境变量**：
   ```bash
   cp .env.example .env
   # 编辑 .env 文件，设置必要的环境变量
   ```

5. **初始化数据库**：
   ```bash
   python -m src.cli initialize
   ```

### 配置说明

系统通过配置文件和环境变量进行配置，主要配置项包括：

- **数据库路径**：SQLite数据库文件的存储路径
- **知识库路径**：向量数据库和文档的存储路径
- **LLM模型**：使用的大语言模型名称和API密钥
- **MCP服务器**：MCP工具服务器的URL和API密钥
- **日志级别**：系统日志的输出级别

配置文件位于 `src/config/settings.py`，您也可以通过环境变量覆盖这些配置。

## 快速入门

### 启动系统

在命令行中执行以下命令启动系统：

```bash
python -m src.cli
```

系统将显示欢迎信息和命令提示符：

```
欢迎使用智能Agent任务管理系统！
输入 'help' 查看可用命令。
> 
```

### 执行第一个任务

1. **创建任务**：
   ```
   > execute --description "分析项目需求并生成初步设计文档"
   ```

2. **查看任务列表**：
   ```
   > list
   ```

3. **查看任务详情**：
   ```
   > show --id 1
   ```

4. **查看任务结果**：
   ```
   > result --id 1
   ```

### 获取帮助

输入 `help` 命令可以查看所有可用命令及其参数：

```
> help
```

输入 `help [command]` 可以查看特定命令的详细帮助：

```
> help execute
```

## 命令行界面

### 基本命令

系统提供以下基本命令：

- `execute`：执行任务
- `list`：列出任务
- `show`：显示任务详情
- `result`：显示任务结果
- `help`：显示帮助信息
- `exit`：退出系统

### 命令格式

命令的基本格式为：

```
command [options]
```

其中，`command` 是命令名称，`options` 是命令的选项参数。

### 选项参数

选项参数以 `--` 开头，例如：

```
execute --description "任务描述" --name "任务名称"
```

### 命令示例

#### 执行任务

```bash
execute --description "分析项目需求并生成初步设计文档" --name "需求分析"
```

#### 列出任务

```bash
list --status completed --limit 10
```

#### 显示任务详情

```bash
show --id 1
```

#### 显示任务结果

```bash
result --id 1 --format json
```

#### 获取帮助

```bash
help execute
```

#### 退出系统

```bash
exit
```

## 任务管理

### 创建任务

使用 `execute` 命令创建并执行任务：

```bash
execute --description "任务描述" --name "任务名称"
```

系统将自动为任务分配一个ID，并开始执行任务。

### 查看任务列表

使用 `list` 命令查看所有任务：

```bash
list
```

您可以使用以下选项过滤任务：

- `--status`：按状态过滤（pending, running, completed, failed）
- `--limit`：限制显示数量
- `--offset`：偏移量

例如，查看已完成的任务：

```bash
list --status completed --limit 10
```

### 查看任务详情

使用 `show` 命令查看任务详情：

```bash
show --id 1
```

系统将显示任务的详细信息，包括任务名称、描述、状态、创建时间、开始时间和结束时间等。

### 查看任务结果

使用 `result` 命令查看任务结果：

```bash
result --id 1
```

您可以使用 `--format` 选项指定结果格式：

- `text`（默认）：文本格式
- `json`：JSON格式
- `table`：表格格式

例如，以JSON格式查看任务结果：

```bash
result --id 1 --format json
```

### 任务状态

任务有以下几种状态：

- `pending`：待执行
- `running`：执行中
- `completed`：已完成
- `failed`：失败

您可以通过任务状态过滤任务列表。

### 子任务管理

系统会自动将复杂任务分解为子任务，您可以通过任务详情查看子任务信息。

子任务有以下几种状态：

- `pending`：待执行
- `running`：执行中
- `waiting_for_info`：等待信息
- `completed`：已完成
- `failed`：失败
- `retrying`：重试中

## 知识库管理

### 添加文档

系统支持将文档添加到知识库中，以便在任务执行过程中检索相关知识。

使用以下命令添加文档：

```bash
knowledge add --file "文档路径" --name "文档名称" --description "文档描述"
```

例如：

```bash
knowledge add --file "/path/to/document.pdf" --name "项目需求文档" --description "包含项目需求的详细文档"
```

### 搜索知识

使用以下命令搜索知识库中的相关知识：

```bash
knowledge search --query "搜索查询" --limit 10
```

例如：

```bash
knowledge search --query "项目需求" --limit 5
```

### 列出文档

使用以下命令列出知识库中的所有文档：

```bash
knowledge list
```

### 删除文档

使用以下命令从知识库中删除文档：

```bash
knowledge delete --id "文档ID"
```

例如：

```bash
knowledge delete --id "doc_123456"
```

### 知识源管理

系统支持管理多个知识源，您可以使用以下命令管理知识源：

#### 创建知识源

```bash
knowledge_source create --name "知识源名称" --description "知识源描述" --type "知识源类型" --path "知识源路径"
```

#### 列出知识源

```bash
knowledge_source list
```

#### 更新知识源

```bash
knowledge_source update --id "知识源ID" --name "新名称" --description "新描述"
```

#### 删除知识源

```bash
knowledge_source delete --id "知识源ID"
```

## 工具管理

### 列出工具

使用以下命令列出所有可用工具：

```bash
tool list
```

系统将显示工具的名称、描述和参数信息。

### 调用工具

系统在任务执行过程中会自动调用相关工具，您也可以手动调用工具：

```bash
tool call --name "工具名称" --parameters "参数JSON"
```

例如，调用文件读取工具：

```bash
tool call --name "read_file" --parameters '{"file_path": "/path/to/file.txt"}'
```

### 工具权限管理

系统支持工具权限管理，您可以使用以下命令管理工具权限：

#### 授予权限

```bash
permission grant --user-id "用户ID" --tool "工具名称"
```

#### 撤销权限

```bash
permission revoke --user-id "用户ID" --tool "工具名称"
```

#### 列出权限

```bash
permission list --user-id "用户ID"
```

### MCP服务器管理

系统支持管理多个MCP服务器，您可以使用以下命令管理MCP服务器：

#### 注册MCP服务器

```bash
mcp_server register --name "服务器名称" --url "服务器URL" --api-key "API密钥"
```

#### 注销MCP服务器

```bash
mcp_server unregister --name "服务器名称"
```

#### 列出MCP服务器

```bash
mcp_server list
```

## 信息补充循环

### 信息需求检测

系统在任务执行过程中会自动检测信息需求，并向用户收集额外信息。

当系统检测到信息需求时，会显示类似以下提示：

```
检测到信息需求：
1. 项目预算（优先级：高）
2. 项目时间表（优先级：中）

请提供这些信息以继续任务执行。
```

### 提供用户输入

当系统检测到信息需求时，您需要提供相关信息：

```
请输入项目预算：100000
请输入项目时间表：6个月
```

### 信息整合

系统会将您提供的信息整合到任务中，并继续执行任务。

### 循环控制

信息补充循环有最大循环次数限制，默认为3次。如果达到最大循环次数，系统会停止循环并询问是否继续。

## 结果验证

### 验证指标

系统会从以下维度验证任务结果的质量：

- **完整性**：结果是否包含所有必要的信息
- **准确性**：结果是否准确无误
- **相关性**：结果是否与任务相关
- **清晰度**：结果是否清晰易懂
- **时效性**：结果是否具有时效性

### 验证报告

系统会生成验证报告，您可以选择以下报告类型：

- **基本报告**：包含基本的验证结果和问题列表
- **详细报告**：包含详细的验证结果、问题分析和改进建议
- **摘要报告**：包含验证结果的摘要和关键指标
- **执行摘要**：包含验证结果的高级摘要和关键建议

### 用户确认

在验证完成后，系统会请求您确认任务结果：

```
任务已完成，验证结果如下：
- 总体分数：0.85
- 状态：通过
- 发现问题：2个

是否确认任务结果？(y/n)
```

您可以选择确认或拒绝任务结果。如果拒绝结果，系统会询问是否需要重新执行任务。

### 改进建议

系统会提供改进建议，帮助您提高任务结果的质量：

```
改进建议：
1. 增加项目背景介绍（优先级：高）
2. 提供更详细的技术方案（优先级：中）
```

## 常见问题

### 安装和配置问题

#### Q: 安装依赖时出现错误
A: 请确保您使用的是Python 3.8或更高版本，并尝试升级pip：
```bash
pip install --upgrade pip
```

#### Q: 如何更改数据库路径？
A: 您可以通过编辑 `.env` 文件中的 `DATABASE_PATH` 环境变量来更改数据库路径。

#### Q: 如何配置LLM模型？
A: 您可以通过编辑 `.env` 文件中的 `LLM_MODEL_NAME` 和 `LLM_API_KEY` 环境变量来配置LLM模型。

### 任务执行问题

#### Q: 任务执行失败怎么办？
A: 您可以查看任务详情了解失败原因，然后尝试重新执行任务。如果问题仍然存在，请联系系统管理员。

#### Q: 如何查看任务执行日志？
A: 您可以使用 `show --id 任务ID` 命令查看任务详情，其中包含执行日志信息。

#### Q: 任务执行时间过长怎么办？
A: 复杂任务可能需要较长时间执行。您可以通过任务详情查看执行进度。如果任务长时间无响应，可以尝试取消任务。

### 知识库问题

#### Q: 添加文档失败怎么办？
A: 请确保文档格式受支持（如PDF、TXT、DOCX等），并检查文档路径是否正确。

#### Q: 搜索知识库时没有结果怎么办？
A: 请确保您已添加相关文档到知识库，并尝试使用不同的搜索关键词。

#### Q: 如何更新知识库中的文档？
A: 您需要先删除旧文档，然后添加新文档。

### 工具使用问题

#### Q: 调用工具失败怎么办？
A: 请检查工具参数是否正确，并确保您有使用该工具的权限。

#### Q: 如何添加新的工具？
A: 您需要联系系统管理员注册新的MCP服务器和工具。

#### Q: 工具执行结果不正确怎么办？
A: 请检查工具参数是否正确，并尝试重新执行工具。如果问题仍然存在，请联系系统管理员。

### 验证和确认问题

#### Q: 验证报告生成失败怎么办？
A: 请确保任务已完成，并尝试重新生成验证报告。如果问题仍然存在，请联系系统管理员。

#### Q: 如何自定义验证指标？
A: 您需要联系系统管理员配置自定义验证指标。

#### Q: 拒绝任务结果后如何重新执行任务？
A: 系统会询问您是否需要重新执行任务。您可以选择重新执行，或修改任务描述后再次执行。

### 其他问题

#### Q: 如何备份数据库？
A: 您可以使用以下命令备份数据库：
```bash
backup create
```

#### Q: 如何恢复数据库？
A: 您可以使用以下命令恢复数据库：
```bash
backup restore --path "备份文件路径"
```

#### Q: 如何查看系统日志？
A: 系统日志通常存储在 `logs` 目录下，您可以使用文本编辑器查看日志文件。

#### Q: 如何联系技术支持？
A: 您可以通过电子邮件 support@example.com 联系技术支持，或访问我们的支持网站 https://support.example.com。